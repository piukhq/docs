asyncapi: '2.4.0'
info:
  title: Midas Internal API
  version: '1.0.0'
  description: |
    MIDAS operations via message queue

    ### Check out its awesome features:

    * Join Loyalty Plan
    * Add or Register a Loyalty Card
    * Request balance and transaction 
servers:
  staging:
    url: guest:guest@rabbitmq:5672
    protocol: amqp
    description: staging broker
    security:
      - saslScram: []

defaultContentType: application/json

channels:
  loyalty_account.join.application:  
    description: Message queue for Join requests
    subscribe:
      message:
        $ref: '#/components/messages/JoinRequest'
components:
  messages:
    JoinRequest:
      name: Join Request
      title: Join Request 
      summary: Request to join a particular Loyalty Plan
      traits:
        - $ref: '#/components/messageTraits/commonHeaders'
      payload:
        $ref: "#/components/schemas/JoinRequestPayload"
  schemas:
    JoinRequestPayload:
      type: object
      properties:
        type:
          type: string
          description: "The event type identifier, used for event subscriptions and routing"
        channel:
          type: string
          description: "The identifier for the Channel through which the Join application was initiated."
        transaction_id:
          type: string
          description: "An end-to-end tracing identifier for requests through Bink services."
        bink_user_id:
          type: string
          description: "The Bink User ID for user that initiatied this Join application."             
        request_id:
          type: string
          description: "The clientâ€™s identifier for the Join application request"
        loyalty_plan:
          type: string
          description: "The Loyalty Plan 'slug' to which the Join application applies"          
        account_id:
          type: string
          description: "An identifier that a Consumer can use to uniquely identify a Loyalty Account within a Loyalty Plan."
        join_data:
          type: string
          description: "The set of data required by the loyalty program in order to successfully process a Join Application."
  securitySchemes:
    saslScram:
      type: scramSha256
      description: Provide your username and password for SASL/SCRAM authentication
  messageTraits:
    commonHeaders:
      headers:
        type: object
        properties:
          my-app-header:
            type: integer
            minimum: 0
            maximum: 100
